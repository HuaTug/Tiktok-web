<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikTok API æµ‹è¯•å·¥å…·</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 { margin-bottom: 10px; }
        .header p { opacity: 0.9; }
        .content {
            padding: 30px;
        }
        .section {
            margin-bottom: 30px;
        }
        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        .token-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        .token-input:focus {
            outline: none;
            border-color: #667eea;
        }
        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            flex: 1;
            min-width: 120px;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-success { background: #28a745; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-info { background: #17a2b8; color: white; }
        .btn-warning { background: #ffc107; color: #333; }
        .result {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            max-height: 500px;
            overflow-y: auto;
        }
        .result pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 13px;
            line-height: 1.6;
        }
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-right: 10px;
        }
        .status-success { background: #d4edda; color: #155724; }
        .status-error { background: #f8d7da; color: #721c24; }
        .status-pending { background: #fff3cd; color: #856404; }
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .api-card {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            border: 2px solid #e0e0e0;
            cursor: pointer;
            transition: all 0.3s;
        }
        .api-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }
        .api-card h4 {
            color: #667eea;
            margin-bottom: 5px;
        }
        .api-card p {
            font-size: 13px;
            color: #666;
            margin: 5px 0;
        }
        .log-entry {
            padding: 10px;
            margin: 5px 0;
            border-left: 3px solid #667eea;
            background: white;
            border-radius: 4px;
        }
        .log-time {
            font-size: 11px;
            color: #999;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ TikTok API æµ‹è¯•å·¥å…·</h1>
            <p>æµ‹è¯•å‰åç«¯APIè¿æ¥çŠ¶æ€</p>
        </div>
        
        <div class="content">
            <!-- Tokenè®¾ç½® -->
            <div class="section">
                <div class="section-title">ğŸ”‘ è®¤è¯Token</div>
                <input type="text" 
                       class="token-input" 
                       id="tokenInput" 
                       placeholder="è¾“å…¥ä½ çš„Access Token (å¯é€‰,æµ‹è¯•ä¸éœ€è¦è®¤è¯çš„æ¥å£å¯ç•™ç©º)"
                       value="">
                <div class="btn-group">
                    <button class="btn btn-primary" onclick="loginAndGetToken()">ä¸€é”®ç™»å½•è·å–Token</button>
                    <button class="btn btn-info" onclick="loadTokenFromStorage()">ä»å­˜å‚¨åŠ è½½Token</button>
                    <button class="btn btn-warning" onclick="clearToken()">æ¸…é™¤Token</button>
                </div>
            </div>

            <!-- å¿«é€Ÿæµ‹è¯• -->
            <div class="section">
                <div class="section-title">âš¡ å¿«é€Ÿæµ‹è¯•</div>
                <div class="btn-group">
                    <button class="btn btn-success" onclick="testAll()">æµ‹è¯•æ‰€æœ‰æ¥å£</button>
                    <button class="btn btn-primary" onclick="testAuth()">æµ‹è¯•è®¤è¯æ¥å£</button>
                    <button class="btn btn-info" onclick="testVideo()">æµ‹è¯•è§†é¢‘æ¥å£</button>
                    <button class="btn btn-warning" onclick="testInteraction()">æµ‹è¯•äº’åŠ¨æ¥å£</button>
                </div>
            </div>

            <!-- APIç«¯ç‚¹æµ‹è¯• -->
            <div class="section">
                <div class="section-title">ğŸ“¡ APIç«¯ç‚¹æµ‹è¯•</div>
                <div class="grid-2" id="apiGrid"></div>
            </div>

            <!-- æµ‹è¯•ç»“æœ -->
            <div class="section">
                <div class="section-title">ğŸ“Š æµ‹è¯•ç»“æœ</div>
                <div class="result" id="result">
                    <p style="color: #999;">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8888';
        
        const API_ENDPOINTS = [
            { name: 'è§†é¢‘æµ', method: 'GET', url: '/v2/video/feed', auth: true },
            { name: 'çƒ­é—¨è§†é¢‘', method: 'GET', url: '/v2/popular/', auth: false },
            { name: 'æ¨èè§†é¢‘', method: 'GET', url: '/v2/recommend/video', auth: true },
            { name: 'ç”¨æˆ·ä¿¡æ¯', method: 'GET', url: '/v1/user/me', auth: true },
            { name: 'è¯„è®ºåˆ—è¡¨', method: 'GET', url: '/v1/comment/list?video_id=1', auth: false },
            { name: 'å…³æ³¨åˆ—è¡¨', method: 'GET', url: '/v1/following/list', auth: true },
            { name: 'ç²‰ä¸åˆ—è¡¨', method: 'GET', url: '/v1/follower/list', auth: true },
            { name: 'æ”¶è—å¤¹åˆ—è¡¨', method: 'GET', url: '/v2/favorite/list', auth: true },
            { name: 'ç‚¹èµåˆ—è¡¨', method: 'GET', url: '/v1/action/list', auth: true },
            { name: 'é€šçŸ¥åˆ—è¡¨', method: 'GET', url: '/v1/notifications', auth: true },
        ];

        // åˆå§‹åŒ–APIå¡ç‰‡
        function initAPICards() {
            const grid = document.getElementById('apiGrid');
            grid.innerHTML = API_ENDPOINTS.map((api, index) => `
                <div class="api-card" onclick="testSingleAPI(${index})">
                    <h4>${api.name}</h4>
                    <p><strong>æ–¹æ³•:</strong> ${api.method}</p>
                    <p><strong>è·¯å¾„:</strong> ${api.url}</p>
                    <p><strong>è®¤è¯:</strong> ${api.auth ? 'âœ… éœ€è¦' : 'âŒ ä¸éœ€è¦'}</p>
                </div>
            `).join('');
        }

        // æ—¥å¿—è¾“å‡º
        function log(message, type = 'info') {
            const result = document.getElementById('result');
            const time = new Date().toLocaleTimeString();
            const statusClass = type === 'success' ? 'status-success' : 
                              type === 'error' ? 'status-error' : 'status-pending';
            
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = `
                <span class="status ${statusClass}">${type.toUpperCase()}</span>
                <span class="log-time">${time}</span>
                <pre>${message}</pre>
            `;
            
            result.insertBefore(entry, result.firstChild);
        }

        // è·å–Token
        function getToken() {
            return document.getElementById('tokenInput').value.trim();
        }

        // ä»å­˜å‚¨åŠ è½½Token
        function loadTokenFromStorage() {
            const token = localStorage.getItem('token');
            const tokenX = localStorage.getItem('tokenX');
            
            if (tokenX) {
                try {
                    const parsed = JSON.parse(tokenX);
                    const actualToken = parsed.token || parsed;
                    document.getElementById('tokenInput').value = actualToken;
                    log('âœ… ä» localStorage(tokenX) åŠ è½½TokenæˆåŠŸ', 'success');
                    return;
                } catch (e) {
                    document.getElementById('tokenInput').value = tokenX;
                    log('âœ… ä» localStorage(tokenX) åŠ è½½TokenæˆåŠŸ', 'success');
                    return;
                }
            }
            
            if (token) {
                try {
                    const parsed = JSON.parse(token);
                    const actualToken = parsed.token || parsed;
                    document.getElementById('tokenInput').value = actualToken;
                    log('âœ… ä» localStorage(token) åŠ è½½TokenæˆåŠŸ', 'success');
                } catch (e) {
                    document.getElementById('tokenInput').value = token;
                    log('âœ… ä» localStorage(token) åŠ è½½TokenæˆåŠŸ', 'success');
                }
            } else {
                log('âŒ æœªæ‰¾åˆ°å­˜å‚¨çš„Token', 'error');
            }
        }

        // æ¸…é™¤Token
        function clearToken() {
            document.getElementById('tokenInput').value = '';
            log('ğŸ—‘ï¸ Tokenå·²æ¸…é™¤', 'info');
        }

        // ç™»å½•è·å–Token
        async function loginAndGetToken() {
            log('ğŸ” æ­£åœ¨ç™»å½•...', 'pending');
            try {
                const response = await fetch(`${API_BASE}/v1/user/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        user_name: 'testuser',
                        password: 'test123456'
                    })
                });
                
                const data = await response.json();
                log(`ç™»å½•å“åº”: ${JSON.stringify(data, null, 2)}`, 'info');
                
                if (data.data && data.data.token) {
                    document.getElementById('tokenInput').value = data.data.token;
                    log('âœ… ç™»å½•æˆåŠŸ,Tokenå·²è‡ªåŠ¨å¡«å…¥', 'success');
                } else {
                    log('âŒ ç™»å½•å¤±è´¥: ' + (data.message || 'æœªçŸ¥é”™è¯¯'), 'error');
                }
            } catch (error) {
                log('âŒ ç™»å½•è¯·æ±‚å¤±è´¥: ' + error.message, 'error');
            }
        }

        // æµ‹è¯•å•ä¸ªAPI
        async function testSingleAPI(index) {
            const api = API_ENDPOINTS[index];
            log(`ğŸ“¡ æµ‹è¯•: ${api.name} [${api.method} ${api.url}]`, 'pending');
            
            const token = getToken();
            if (api.auth && !token) {
                log('âŒ æ­¤æ¥å£éœ€è¦è®¤è¯,è¯·å…ˆè®¾ç½®Token', 'error');
                return;
            }
            
            try {
                const headers = { 'Content-Type': 'application/json' };
                if (token) {
                    headers['Access-Token'] = token;
                }
                
                const response = await fetch(`${API_BASE}${api.url}`, {
                    method: api.method,
                    headers: headers
                });
                
                const data = await response.json();
                
                if (response.ok || data.code === 0 || data.code === 10000 || data.code === 200) {
                    log(`âœ… ${api.name} æˆåŠŸ\nå“åº”: ${JSON.stringify(data, null, 2)}`, 'success');
                } else {
                    log(`âš ï¸ ${api.name} è¿”å›é”™è¯¯\nçŠ¶æ€: ${response.status}\nå“åº”: ${JSON.stringify(data, null, 2)}`, 'error');
                }
            } catch (error) {
                log(`âŒ ${api.name} è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•æ‰€æœ‰æ¥å£
        async function testAll() {
            log('ğŸš€ å¼€å§‹æµ‹è¯•æ‰€æœ‰æ¥å£...', 'pending');
            for (let i = 0; i < API_ENDPOINTS.length; i++) {
                await testSingleAPI(i);
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            log('âœ… æ‰€æœ‰æ¥å£æµ‹è¯•å®Œæˆ', 'success');
        }

        // æµ‹è¯•è®¤è¯æ¥å£
        async function testAuth() {
            await loginAndGetToken();
            await testSingleAPI(3); // ç”¨æˆ·ä¿¡æ¯
        }

        // æµ‹è¯•è§†é¢‘æ¥å£
        async function testVideo() {
            await testSingleAPI(0); // è§†é¢‘æµ
            await testSingleAPI(1); // çƒ­é—¨è§†é¢‘
            await testSingleAPI(2); // æ¨èè§†é¢‘
        }

        // æµ‹è¯•äº’åŠ¨æ¥å£
        async function testInteraction() {
            await testSingleAPI(4); // è¯„è®ºåˆ—è¡¨
            await testSingleAPI(8); // ç‚¹èµåˆ—è¡¨
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = () => {
            initAPICards();
            loadTokenFromStorage();
        };
    </script>
</body>
</html>
