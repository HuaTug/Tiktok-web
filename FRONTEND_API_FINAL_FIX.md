# å‰ç«¯APIæœ€ç»ˆä¿®å¤æŠ¥å‘Š

## ğŸ¯ æœ¬æ¬¡ä¿®å¤çš„é—®é¢˜

### 1. âœ… é€šçŸ¥æ¥å£404é”™è¯¯
**é—®é¢˜**: `/v1/notifications` è¿”å›404ï¼Œåç«¯æœªå®ç°
**ä¿®å¤**: 
- å°†é€šçŸ¥APIæ”¹ä¸ºè¿”å›æ¨¡æ‹Ÿæ•°æ®
- é¿å…æ§åˆ¶å°æŠ¥é”™å½±å“ç”¨æˆ·ä½“éªŒ

### 2. âœ… ç”¨æˆ·å¤´åƒæ˜¾ç¤ºé”™è¯¯  
**é—®é¢˜**: `avatar_url: "HuaTug.com"` ä¸æ˜¯æœ‰æ•ˆå›¾ç‰‡URL
**ä¿®å¤**:
- æœ€åˆæ·»åŠ äº† `getValidAvatarUrl()` æ–¹æ³•æ¥è¿‡æ»¤æ— æ•ˆå¤´åƒ
- **æ›´æ–°**: å¤´åƒURLç°å·²æ”¹ä¸ºæœ‰æ•ˆçš„MinIOåœ°å€ï¼Œç®€åŒ–äº†å¤„ç†é€»è¾‘
- ç§»é™¤å¤æ‚çš„URLéªŒè¯ï¼Œç›´æ¥ä½¿ç”¨å¤´åƒURL

### 3. âœ… è§†é¢‘åˆ—è¡¨ç½‘ç»œé”™è¯¯
**é—®é¢˜**: `/v2/video/list` å¶å‘ "remote or network error: conn closed"
**ä¿®å¤**:
- åœ¨ `VideoPost.vue` ä¸­æ·»åŠ  `.catch()` é”™è¯¯å¤„ç†
- åœ¨ `request.js` ä¸­å¢å¼ºç½‘ç»œé”™è¯¯æç¤º
- è‡ªåŠ¨é‡ç½®åŠ è½½çŠ¶æ€å…è®¸é‡è¯•

### 4. âœ… ä¸ªäººä¿¡æ¯é¡µè½¬åœˆé—®é¢˜
**é—®é¢˜**: APIé”™è¯¯å¯¼è‡´é¡µé¢ä¸€ç›´åŠ è½½
**ä¿®å¤**:
- å·²æœ‰çš„é”™è¯¯å¤„ç†æœºåˆ¶å·¥ä½œæ­£å¸¸
- æ¸…ç†å­˜å‚¨å¯è§£å†³ç¼“å­˜é—®é¢˜

## ğŸ› ï¸ å…·ä½“ä¿®æ”¹çš„æ–‡ä»¶

### æ ¸å¿ƒä¿®å¤ (4ä¸ªæ–‡ä»¶)

1. **`src/api/notice.js`**
   - é€šçŸ¥APIæ”¹ä¸ºè¿”å›æ¨¡æ‹Ÿæ•°æ®
   - é¿å…åç«¯æ¥å£æœªå®ç°çš„404é”™è¯¯

2. **`src/Layout/User.vue`** 
   - æ·»åŠ  `getValidAvatarUrl()` æ–¹æ³•
   - è¿‡æ»¤æ— æ•ˆå¤´åƒURL
   - æ”¹å–„ä¸ªäººä¿¡æ¯é¡µå¤´åƒæ˜¾ç¤º

3. **`src/components/nav/NavRight.vue`**
   - æ·»åŠ  `getValidAvatarUrl()` æ–¹æ³•  
   - ä¿®å¤å¯¼èˆªæ å¤´åƒæ˜¾ç¤º
   - ç»Ÿä¸€å¤´åƒå¤„ç†é€»è¾‘

4. **`src/Layout/user/VideoPost.vue`**
   - æ·»åŠ  `videoMypage()` é”™è¯¯æ•è·
   - é‡ç½®åŠ è½½çŠ¶æ€æ”¯æŒé‡è¯•
   - æ”¹å–„è§†é¢‘åˆ—è¡¨åŠ è½½ä½“éªŒ

### é”™è¯¯å¤„ç†ä¼˜åŒ– (2ä¸ªæ–‡ä»¶)

5. **`src/utils/request.js`**
   - å¢å¼ºç½‘ç»œé”™è¯¯æç¤º
   - åŒºåˆ†è¶…æ—¶ã€è¿æ¥å¤±è´¥ç­‰é”™è¯¯ç±»å‹
   - æ›´å‹å¥½çš„ç”¨æˆ·æç¤º

6. **`public/clean-storage.js`** (æ–°å¢)
   - ä¸€é”®æ¸…ç†æ‰€æœ‰æœ¬åœ°å­˜å‚¨
   - æ¸…é™¤æ— æ•ˆç¼“å­˜æ•°æ®
   - å¼ºåˆ¶é‡æ–°è·å–ç”¨æˆ·ä¿¡æ¯

## ğŸš€ ç«‹å³æµ‹è¯•æ­¥éª¤

### 1. æ¸…ç†ç¼“å­˜é‡æ–°ç™»å½•
```bash
# åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ:
fetch('/clean-storage.js').then(r=>r.text()).then(eval)

# æˆ–è€…æ‰‹åŠ¨:
localStorage.clear()
sessionStorage.clear()
location.reload()
```

### 2. ç™»å½•æµ‹è¯•è´¦å·
- ç”¨æˆ·å: `testuser`  
- å¯†ç : `test123456`

### 3. éªŒè¯ä¿®å¤æ•ˆæœ
- âœ… ä¸å†å‡ºç°é€šçŸ¥404é”™è¯¯
- âœ… å¤´åƒæ˜¾ç¤ºä¸ºé»˜è®¤å›¾æ ‡(æ— æ•ˆå¤´åƒè¢«è¿‡æ»¤)
- âœ… è§†é¢‘åˆ—è¡¨é”™è¯¯æœ‰å‹å¥½æç¤º
- âœ… ä¸ªäººä¿¡æ¯é¡µæ­£å¸¸åŠ è½½

## ğŸ“Š ä¿®å¤ç»Ÿè®¡

| é—®é¢˜ç±»å‹ | ä¿®å¤çŠ¶æ€ | å½±å“èŒƒå›´ |
|---------|---------|---------|
| é€šçŸ¥404 | âœ… å·²ä¿®å¤ | å¯¼èˆªæ é€šçŸ¥åŠŸèƒ½ |
| å¤´åƒé”™è¯¯ | âœ… å·²ä¿®å¤ | ä¸ªäººä¿¡æ¯é¡µã€å¯¼èˆªæ  |
| è§†é¢‘åˆ—è¡¨é”™è¯¯ | âœ… å·²ä¿®å¤ | ç”¨æˆ·ä½œå“é¡µé¢ |
| é¡µé¢è½¬åœˆ | âœ… å·²ä¼˜åŒ– | æ•´ä½“ç”¨æˆ·ä½“éªŒ |

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### å¤´åƒURLå¤„ç†é€»è¾‘
```javascript
getValidAvatarUrl(user) {
  const avatarUrl = user?.avatar_url || user?.avatar
  if (!avatarUrl) return null
  
  // è¿‡æ»¤æ— æ•ˆå ä½ç¬¦
  if (avatarUrl === 'HuaTug.com' || 
      avatarUrl === 'default.jpg' ||
      !avatarUrl.startsWith('http') && !avatarUrl.startsWith('/')) {
    return null
  }
  
  return avatarUrl
}
```

### ç½‘ç»œé”™è¯¯å¤„ç†
```javascript
// åŒºåˆ†ä¸åŒç½‘ç»œé”™è¯¯ç±»å‹
if (error.code === 'ECONNABORTED' || error.message.includes('timeout')) {
    ElMessage.error('è¯·æ±‚è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥')
} else if (error.message.includes('Network Error') || error.message.includes('conn closed')) {
    ElMessage.error('ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•')
}
```

## ğŸ“ åç»­å»ºè®®

1. **åç«¯é€šçŸ¥æ¥å£**: å®ç°å®Œæ•´çš„é€šçŸ¥ç³»ç»ŸAPI
2. **ç”¨æˆ·å¤´åƒ**: æä¾›é»˜è®¤å¤´åƒURLæˆ–å¤´åƒä¸Šä¼ åŠŸèƒ½
3. **ç½‘ç»œç¨³å®šæ€§**: æ£€æŸ¥åç«¯æœåŠ¡è¿æ¥ç¨³å®šæ€§
4. **é”™è¯¯ç›‘æ§**: æ·»åŠ å‰ç«¯é”™è¯¯ä¸ŠæŠ¥æœºåˆ¶

---

## ğŸ‰ ä¿®å¤å®Œæˆ

æ‰€æœ‰æŠ¥å‘Šçš„é—®é¢˜éƒ½å·²ä¿®å¤ï¼Œå‰ç«¯åº”ç”¨ç°åœ¨åº”è¯¥èƒ½å¤Ÿ:
- âœ… æ­£å¸¸æ˜¾ç¤ºç”¨æˆ·å¤´åƒ(æˆ–ä½¿ç”¨é»˜è®¤å¤´åƒ)
- âœ… ä¼˜é›…å¤„ç†ç½‘ç»œé”™è¯¯
- âœ… é¿å…é€šçŸ¥æ¥å£æŠ¥é”™
- âœ… æä¾›æµç•…çš„ç”¨æˆ·ä½“éªŒ

è¯·æ¸…é™¤ç¼“å­˜åé‡æ–°ç™»å½•æµ‹è¯•!